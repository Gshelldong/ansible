# ansible-一键完成LNMP架构

<br> 

## 网站架构图

![image-20200703201358432](https://files.cnblogs.com/files/gshelldon/image-20200703201358432.bmp)

## ansible一键完成lnmp架构

ansible一键完成整个lnmp架构部署，减少运维部署的工作量，集群架构优化，解决共享存储单点故障问题，网站数据定时备份，MHA数据库高可用，nginx负载均衡本地缓存，https加密访问，keepalived+nginx高可用。

<br>

## IP地址规划


| hostname | WlanIP     | LanIP        | 作用                           |
| -------- | ---------- | ------------ | ------------------------------ |
| m01      | 10.0.0.61  | 172.16.1.61  | 管理机、时间同步服务器         |
|          | 10.0.0.3   |              | 虚拟IP                         |
| lb01     | 10.0.0.5   | 172.16.1.5   | 负载均衡器、keepalived高可用主 |
| lb02     | 10.0.0.6   | 172.16.1.6   | 负载均衡器、keepalived高可用备 |
| web01    | 10.0.0.7   | 172.16.1.7   | web服务器                      |
| web02    | 10.0.0.8   | 172.16.1.8   | web服务器                      |
| web03    | 10.0.0.9   | 172.16.1.9   | web服务器                      |
| nfs01    | 10.0.0.31  | 172.16.1.31  | 共享存储                       |
| backup   | 10.0.0.41  | 172.16.1.41  | 备份服务器                     |
|          |            | 172.16.1.51  | MHA高可用的虚拟IP              |
| db01     | 10.0.0.52  | 172.16.1.52  | 数据库服务器                   |
| db02     | 10.0.0.53  | 172.16.1.53  | 数据库服务器从                 |
| db03     | 10.0.0.54  | 172.16.1.54  | 数据库从，MHA的管理节点        |
| zabbix   | 10.0.0.101 | 172.16.1.101 | 监控服务器                     |
| jenkins  | 10.0.0.102 | 172.16.1.102 | 代码发布服务器                 |
| gitlab   | 10.0.0.102 | 172.16.1.102 | 开发使用的，内网的代码仓库     |

注：jenkins和gitlab没有在ansible剧本当中，注意基础优化防火墙中的策略配置问题，会导致ssh连接补上。

<br>

## 基础优化部署：

1. ntp时间同步
2. firewalld 内网安全优化
3. 基础环境安装包
4. 统一操作权限用户`www`

## 基础架构：

- wordpress

  LNMP 架构

- wecenter

  LNMP 架构

- jpress

  LNMT 架构

1. 以架构为中心
2. 数据库分离
3. 共享存储
4. 负载均衡
5. 高可用

## 架构优化项目：

1. https加密访问网站
2. keepalived + nginx
3. MHA数据库高可用
4. nfs实时备份
5. nginx本地缓存

## 自动化运维：

1. gitlab + jenkins
2. zabbix
3. jumpserver
4. m01

